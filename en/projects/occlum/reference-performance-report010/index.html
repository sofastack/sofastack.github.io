<!DOCTYPE html>
<html>

<head>
	<title>
	MOSN 0.1.0 performance report Â· SOFAStack
</title>
	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="SOFAStack is a Scalable Open Financial Architecture for building cloud native applications" />

<meta name="generator" content="Hugo 0.55.5" /><link rel="shortcut icon" href=https://gw.alipayobjects.com/os/q/cms/images/jqu9346l/4ba95631-2489-4885-881f-bc7f8d787d5e_w64_h61.png type="image/png">

<link href="https://unpkg.com/purecss@1.0.0/build/base-min.css" rel="stylesheet">



<link href="/sofastack.tech/css/main.css" rel="stylesheet">
<link href="/sofastack.tech/css/zoom-image.css" rel="stylesheet">

<script src="/sofastack.tech/js/iconfont.js"></script>
<script src="/sofastack.tech/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>window.SITE_LANGUAGE = "en"</script>
<script src="/sofastack.tech/js/app.js"></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-142131411-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body>
	<header class="ss-header">
	<nav class="navbar" role="navigation" aria-label="main navigation">
		<div class="navbar-brand">
			<a class="logo-link" href="/sofastack.tech/en/">
				<img class="logo" src="/sofastack.tech/img/logo.png">
			</a>
			<div class="-show-mobile">
				<a id="mobile-menu-icon">
					<svg class="icon" aria-hidden="true">
						<use xlink:href="#icon-menu"></use>
					</svg>
				</a>
				<nav id="mobile-menu">
						<div id="js-menu-search-mobile" class="navbar-search-mobile">
							<input class="input" placeholder="Search">
							<svg class="icon" aria-hidden="true">
								<use xlink:href="#icon-search"></use>
							</svg>
						</div>
					
          
            <a
              class=""
              href="/sofastack.tech/en/projects/">
              <span>
                Projects
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/guides/">
              <span>
                Guides
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/blog/">
              <span>
                Blog
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/activities/">
              <span>
                Activity
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/awesome/">
              <span>
                Awesome SOFA
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
					
				</nav>
			</div>
		</div>

		<div class="navbar-menu -hidden-mobile">
			<div class="navbar-start">
				
				
					<a class="navbar-item "
						href="/sofastack.tech/en/projects/">Projects</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/guides/">Guides</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/blog/">Blog</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/activities/">Activity</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/awesome/">Awesome SOFA</a>
				
			</div>
			<div class="navbar-end">
				<div class="navbar-item">
					<div id="js-menu-search" class="navbar-search">
						<input class="input" placeholder="Search">
						<svg class="icon" aria-hidden="true">
							<use xlink:href="#icon-search"></use>
						</svg>
					</div>
				</div>
				<div class="navbar-item">
					
				</div>
			</div>
		</div>
	</nav>
</header>


	

	

	

	

	



	

<div class="ss-layout-container">
	<aside class="ss-layout-aside -left ss-card -soft-hidden">
		






	<div id="js-drawer" class="ss-toc">
		<div id="js-drawer-handle" class="drawer-handle">
			<svg class="icon icon-menu" aria-hidden="true">
				<use xlink:href="#icon-menu"></use>
			</svg>
			<svg class="icon icon-close" aria-hidden="true">
				<use xlink:href="#icon-close"></use>
			</svg>
		</div>
		<div class="drawer-body">
			<div class="header" title="Occlum is a memory-safe, multi-process library OS for Intel SGX.">Occlum

































































































































































































































































































































































































































































































<div class="ss-toc-list-card -hidden-mobile">
	<svg class="icon -hidden-mobile" aria-hidden="true">
		<use xlink:href="#icon-menu1"></use>
	</svg>
	<div class="ss-tooltip">
		
		
		<div class="toc-list">
			<h4 class="title">Main Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-boot/overview/>
						SOFABoot
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-rpc/overview/>
						SOFARPC
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-tracer/overview/>
						SOFATracer
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-lookout/overview/>
						SOFALookout
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-registry/overview/>
						SOFARegistry
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Incubating Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-mesh/overview/>
						SOFAMesh
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-dashboard/overview/>
						SOFADashboard
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Tool Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-bolt/overview/>
						SOFABolt
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-jraft/overview/>
						SOFAJRaft
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-acts/overview/>
						SOFAActs
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://www.sofastack.tech/en/projects/sofa-boot/sofa-ark-readme//>
						SOFAArk
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Ecosystem Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://mosn.io/en/>
						MOSN
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://occlum.io/>
						Occlum
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://seata.io/>
						Seata
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://mosn.io/layotto/>
						Layotto
					</a>
				</li>
				
			</ul>
		</div>
		
		
	</div>
</div>

			</div>
			<div class="body">
				



<ul class="leaf-section">
	
</ul>
			</div>
		</div>
	</div>

	</aside>

	<main class="ss-layout-main -card">
		




<div class="ss-meta">
	<div class="container">
		<h1 class="title">
			MOSN 0.1.0 performance report
		</h1>
		<a class="edit-button -hidden-mobile"
			href="https://github.com/sofastack/sofastack.tech/edit/master/content/en/projects/occlum/reference-performance-report010/index.md"
		>Edit</a>
	</div>
	<div class="meta">
		Update time: 2024-06-18 
		
			
		
	</div>
</div>

		<article class="typo">
  <h2 id="instructions-on-performance-report">Instructions on performance report</h2>

<p>The following performance report presents the performance comparison data of MOSN 0.1.0 with envoy in terms of pure TCP forwarding for Bolt and HTTP1.x protocols, mainly including QPS, RTT, failure rate, success rate and other indicators.</p>

<p>It is significant to note the following optimizations in v0.1.0 which are intended to improve the forwarding performance of MOSN.</p>

<ul>
<li>For thread model, MOSN uses the worker goroutine pool to handle stream events, and uses two independent goroutines to handle read and write IO separately.</li>
<li>For single-core forwarding, in the case of specifying <code>P=1</code>, MOSN binds CPU with cores to improve the call execution efficiency of the system and the locality affinity of cache.</li>
<li>For memory, in the case of binding single core, MOSN uses SLAB-style recycling mechanism to improve reuse and reduce memory copy.</li>
<li>For IO, MOSN mainly implements optimization by controlling the read/write buffer size, read/write timing, read/write frequency and other parameters.</li>
</ul>

<p>The performance test data is as follows:</p>

<h2 id="tcp-proxy-performance-data">TCP proxy performance data</h2>

<p>For the same deployment mode, this report compares MOSN 0.1.0 and envoy for the upper-layer protocol Bolt (SOFARPC related protocol) and HTTP1.1 respectively.</p>

<h3 id="deployment-mode">Deployment mode</h3>

<p>The pressure test is deployed in a pure proxy mode. The client process accesses the server process through the MOSN process and serves as a forwarding proxy. The client process, MOSN process, and server process run on the machines which belong to different network segments. The network delay of the direct access from the client to server is about 2.5ms.</p>

<h3 id="client">Client</h3>

<h4 id="bolt-protocol-send-1k-string">Bolt protocol (send 1K string)</h4>

<p>The client that sends the Bolt protocol data uses the online pressure generators developed by Ant Financial and deploys the SOFARPC client.</p>

<p>On the pressure generator performance page, you can see the QPS, success/failure counts, RT and other parameters.</p>

<h4 id="http1-1-protocol-send-1k-string">HTTP1.1 protocol (send 1K string)</h4>

<p>Use ApacheBench/2.3. The test instructions are:</p>

<pre><code class="language-bash">ab -n $RPC -c $CPC -p 1k.txt -T &quot;text/plain&quot; -k http://11.166.161.136:12200/tcp_bench &gt; ab.log.$CPU_IDX &amp;
</code></pre>

<h3 id="mesh-machine-specifications">Mesh machine specifications</h3>

<p>The mesh runs in a container where the CPU is an exclusive logical core. The specifications are as follows:</p>

<table>
<thead>
<tr>
<th>Category</th>
<th>Information</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>3.10.0-327.ali2008.alios7.x86_64</td>
</tr>

<tr>
<td>CPU</td>
<td>Intel&reg; Xeon&reg; CPU E5-2650 v2 @ 2.60GHz X 1</td>
</tr>
</tbody>
</table>

<h3 id="upstream-machine-specifications">Upstream machine specifications</h3>

<table>
<thead>
<tr>
<th>Category</th>
<th>Information</th>
</tr>
</thead>

<tbody>
<tr>
<td>OS</td>
<td>2.6.32-431.17.1.el6.FASTSOCKET</td>
</tr>

<tr>
<td>CPU</td>
<td>Intel&reg; Xeon&reg; CPU E5620 @ 2.40GHz X 16</td>
</tr>
</tbody>
</table>

<h3 id="bolt-protocol-test-result">Bolt protocol test result</h3>

<h4 id="performance-data">Performance data</h4>

<table>
<thead>
<tr>
<th>Indicators</th>
<th>MOSN</th>
<th>Envoy</th>
</tr>
</thead>

<tbody>
<tr>
<td>QPS</td>
<td>103500</td>
<td>104000</td>
</tr>

<tr>
<td>RT</td>
<td>16.23ms</td>
<td>15.88ms</td>
</tr>

<tr>
<td>MEM</td>
<td>31m</td>
<td>18m</td>
</tr>

<tr>
<td>CPU</td>
<td>100%</td>
<td>100%</td>
</tr>
</tbody>
</table>

<h4 id="conclusion">Conclusion</h4>

<p>For single-core TCP forwarding, there is little difference between MOSN 0.1.0 and Envoy 1.7 in terms of performance in the condition with full load, such as QPS, RTT and success/failure counts. We will continue to optimize in the subsequent versions.</p>

<h3 id="http-1-1-test-result">HTTP/1.1 test result</h3>

<p>Since the HTTP/1.1 request response model is PING-PONG, QPS is positively correlated with the number of concurrences. The following tests are performed for different concurrence counts.</p>

<h4 id="concurrences-20">Concurrences - 20</h4>

<table>
<thead>
<tr>
<th>Indicators</th>
<th>MOSN</th>
<th>Envoy</th>
</tr>
</thead>

<tbody>
<tr>
<td>QPS</td>
<td>5600</td>
<td>5600</td>
</tr>

<tr>
<td>RT (mean)</td>
<td>3.549ms</td>
<td>3.545ms</td>
</tr>

<tr>
<td>RT (P99)</td>
<td>4ms</td>
<td>4ms</td>
</tr>

<tr>
<td>RT (P98)</td>
<td>4ms</td>
<td>4ms</td>
</tr>

<tr>
<td>RT (P95)</td>
<td>4ms</td>
<td>4ms</td>
</tr>

<tr>
<td>MEM</td>
<td>24m</td>
<td>23m</td>
</tr>

<tr>
<td>CPU</td>
<td>40%</td>
<td>20%</td>
</tr>
</tbody>
</table>

<h4 id="concurrences-40">Concurrences - 40</h4>

<table>
<thead>
<tr>
<th>Indicators</th>
<th>MOSN</th>
<th>Envoy</th>
</tr>
</thead>

<tbody>
<tr>
<td>QPS</td>
<td>11150</td>
<td>11200</td>
</tr>

<tr>
<td>RT (mean)</td>
<td>3.583ms</td>
<td>3.565ms</td>
</tr>

<tr>
<td>RT (P99)</td>
<td>4ms</td>
<td>4ms</td>
</tr>

<tr>
<td>RT (P98)</td>
<td>4ms</td>
<td>4ms</td>
</tr>

<tr>
<td>RT (P95)</td>
<td>4ms</td>
<td>4ms</td>
</tr>

<tr>
<td>MEM</td>
<td>34m</td>
<td>24m</td>
</tr>

<tr>
<td>CPU</td>
<td>70%</td>
<td>40%</td>
</tr>
</tbody>
</table>

<h4 id="concurrences-200">Concurrences - 200</h4>

<table>
<thead>
<tr>
<th>Indicators</th>
<th>MOSN</th>
<th>Envoy</th>
</tr>
</thead>

<tbody>
<tr>
<td>QPS</td>
<td>29670</td>
<td>38800</td>
</tr>

<tr>
<td>RT (mean)</td>
<td>5.715ms</td>
<td>5.068ms</td>
</tr>

<tr>
<td>RT (P99)</td>
<td>16ms</td>
<td>7ms</td>
</tr>

<tr>
<td>RT (P98)</td>
<td>13ms</td>
<td>7ms</td>
</tr>

<tr>
<td>RT (P95)</td>
<td>11ms</td>
<td>6ms</td>
</tr>

<tr>
<td>MEM</td>
<td>96m</td>
<td>24m</td>
</tr>

<tr>
<td>CPU</td>
<td>100%</td>
<td>95%</td>
</tr>
</tbody>
</table>

<h4 id="concurrences-220">Concurrences - 220</h4>

<table>
<thead>
<tr>
<th>Indicators</th>
<th>MOSN</th>
<th>Envoy</th>
</tr>
</thead>

<tbody>
<tr>
<td>QPS</td>
<td>30367</td>
<td>41070</td>
</tr>

<tr>
<td>RT (mean)</td>
<td>8.201ms</td>
<td>5.369ms</td>
</tr>

<tr>
<td>RT (P99)</td>
<td>20ms</td>
<td>9ms</td>
</tr>

<tr>
<td>RT (P98)</td>
<td>19ms</td>
<td>8ms</td>
</tr>

<tr>
<td>RT (P95)</td>
<td>16ms</td>
<td>8ms</td>
</tr>

<tr>
<td>MEM</td>
<td>100m</td>
<td>24m</td>
</tr>

<tr>
<td>CPU</td>
<td>100%</td>
<td>100%</td>
</tr>
</tbody>
</table>

<h4 id="conclusion-1">Conclusion</h4>

<p>When the upper-layer protocol is HTTP/1.X., a certain gap exists between MOSN and Envoy in terms of performance.</p>

<p>The preliminary conclusion is that in the PING-PONG package delivery model, MOSN cannot merge the read/write system calls. In the scenario where SOFARPC can merge the calls, MOSN&rsquo;s HTTP performance is weaker than that of Envoy because the syscall count significantly increases.</p>

<p>This problem will be optimized in version 0.2.0.</p>

<h2 id="appendix">Appendix</h2>

<h3 id="envoy-version-information">Envoy version information</h3>

<ul>
<li>version:1.7</li>
<li>Tag:1ef23d481a4701ad4a414d1ef98036bd2ed322e7</li>
</ul>

<h3 id="envoy-tcp-test-configuration">Envoy TCP test configuration</h3>

<pre><code class="language-yaml">static_resources:
  listeners:
  - address:
      socket_address:
        address: 0.0.0.0
        port_value: 12200
    filter_chains:
    - filters:
      - name: envoy.tcp_proxy
        config:
          stat_prefix: ingress_tcp
          cluster: sofa_server
  clusters:
  - name: sofa_server
    connect_timeout: 0.25s
    type: static
    lb_policy: round_robin
    hosts:
    - socket_address:
        address: 10.210.168.5
        port_value: 12222
    - socket_address:
        address: 10.210.168.5
        port_value: 12223
    - socket_address:
        address: 10.210.168.5
        port_value: 12224
    - socket_address:
        address: 10.210.168.5
        port_value: 12225
admin:
  access_log_path: &quot;/dev/null&quot;
  address:
    socket_address:
      address: 0.0.0.0
      port_value: 8001
</code></pre>

</article>

<script>
  const article = document.querySelector('article.typo')
  
  const imgElements = article.querySelectorAll('img');
  
  imgElements.forEach(img => {
    const src = img.getAttribute('src');
    
    if (src.toLowerCase().endsWith('.image')) {
      img.setAttribute('src', src.replace('.image', ''));
    }
    img.setAttribute('referrerpolicy', 'no-referrer');
  });
</script>


	</main>
</div>



	


<footer class="ss-footer">
	<div class="container">
		<div class="links">
			
				<div class="cate">
					<h2 class="cate-title">Resources</h2>
					
						<a class="link" href="https://github.com/sofastack">Github</a>
					
						<a class="link" href="https://gitee.com/sofastack/">Gitee</a>
					
						<a class="link" href="https://github.com/sofastack-guides">Samples</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Social Media</h2>
					
						<a class="link" href="https://zhuanlan.zhihu.com/sofastack">Zhihu</a>
					
						<a class="link" href="https://weibo.com/sofastack">Weibo</a>
					
						<a class="link" href="https://twitter.com/sofastack_io">Twitter</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Get Involved</h2>
					
						<a class="link" href="https://github.com/sofastack/sofastack.tech/issues">Feedback</a>
					
						<a class="link" href="https://github.com/sofastack/community">Community</a>
					
						<a class="link" href="https://github.com/sofastack/sofastack.tech/wiki">Wiki</a>
					
						<a class="link" href="mailto:sofa@alipay.cloud.com">Email</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Ant Financial Open Source</h2>
					
						<a class="link" href="https://ant.design/">Ant Design</a>
					
						<a class="link" href="https://eggjs.org/">Egg</a>
					
						<a class="link" href="https://sqlflow.org">SQLFlow</a>
					
						<a class="link" href="https://tech.antfin.com/open-source">More</a>
					
				</div>
			
		</div>
		<div class="qrcode">
			
				<div>
					<img class="qrcode-img" src="/sofastack.tech/img/qrcode/qrcode_1.png" />
					<p class="qrcode-desc">Wechat Official Account</p>
				</div>
			
				<div>
					<img class="qrcode-img" src="/sofastack.tech/img/qrcode/qrcode_2.png" />
					<p class="qrcode-desc">DingTalk Group</p>
				</div>
			
		</div>
	</div>
	<div class="copyright">
		<p>
			Â© 2018 - 2022  The SOFAStack Authors
			<a href="http://beian.miit.gov.cn/">æµ ICP å¤ 16045294 å·-3</a>
		</p>
	</div>
</footer>

</body>

</html>