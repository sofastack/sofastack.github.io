<!DOCTYPE html>
<html>

<head>
	<title>
	Print traceId and spanId in application log · SOFAStack
</title>
	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="SOFAStack is a Scalable Open Financial Architecture for building cloud native applications" />

<meta name="generator" content="Hugo 0.55.5" /><link rel="shortcut icon" href=https://gw.alipayobjects.com/os/q/cms/images/jqu9346l/4ba95631-2489-4885-881f-bc7f8d787d5e_w64_h61.png type="image/png">

<link href="https://unpkg.com/purecss@1.0.0/build/base-min.css" rel="stylesheet">



<link href="/sofastack.tech/css/main.css" rel="stylesheet">
<link href="/sofastack.tech/css/zoom-image.css" rel="stylesheet">

<script src="/sofastack.tech/js/iconfont.js"></script>
<script src="/sofastack.tech/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>window.SITE_LANGUAGE = "en"</script>
<script src="/sofastack.tech/js/app.js"></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-142131411-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body>
	<header class="ss-header">
	<nav class="navbar" role="navigation" aria-label="main navigation">
		<div class="navbar-brand">
			<a class="logo-link" href="/sofastack.tech/en/">
				<img class="logo" src="/sofastack.tech/img/logo.png">
			</a>
			<div class="-show-mobile">
				<a id="mobile-menu-icon">
					<svg class="icon" aria-hidden="true">
						<use xlink:href="#icon-menu"></use>
					</svg>
				</a>
				<nav id="mobile-menu">
						<div id="js-menu-search-mobile" class="navbar-search-mobile">
							<input class="input" placeholder="Search">
							<svg class="icon" aria-hidden="true">
								<use xlink:href="#icon-search"></use>
							</svg>
						</div>
					
          
            <a
              class=""
              href="/sofastack.tech/en/projects/">
              <span>
                Projects
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/guides/">
              <span>
                Guides
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/blog/">
              <span>
                Blog
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/activities/">
              <span>
                Activity
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/awesome/">
              <span>
                Awesome SOFA
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
					
            
              <a href="/sofastack.tech/projects/sofa-tracer/print-traceid-spanid/">
                <span>中文</span>
                <svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"></use></svg>
              </a>
						
					
				</nav>
			</div>
		</div>

		<div class="navbar-menu -hidden-mobile">
			<div class="navbar-start">
				
				
					<a class="navbar-item "
						href="/sofastack.tech/en/projects/">Projects</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/guides/">Guides</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/blog/">Blog</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/activities/">Activity</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/awesome/">Awesome SOFA</a>
				
			</div>
			<div class="navbar-end">
				<div class="navbar-item">
					<div id="js-menu-search" class="navbar-search">
						<input class="input" placeholder="Search">
						<svg class="icon" aria-hidden="true">
							<use xlink:href="#icon-search"></use>
						</svg>
					</div>
				</div>
				<div class="navbar-item">
					
						
							<a class="translation" href="/sofastack.tech/projects/sofa-tracer/print-traceid-spanid/">中</a>
						
					
				</div>
			</div>
		</div>
	</nav>
</header>


	

	

	

	

	



	

<div class="ss-layout-container">
	<aside class="ss-layout-aside -left ss-card -soft-hidden">
		






	<div id="js-drawer" class="ss-toc">
		<div id="js-drawer-handle" class="drawer-handle">
			<svg class="icon icon-menu" aria-hidden="true">
				<use xlink:href="#icon-menu"></use>
			</svg>
			<svg class="icon icon-close" aria-hidden="true">
				<use xlink:href="#icon-close"></use>
			</svg>
		</div>
		<div class="drawer-body">
			<div class="header" title="SOFATracer is a distributed link tracing system based on OpenTracing specification.">SOFATracer

































































































































































































































































































































































































































































































<div class="ss-toc-list-card -hidden-mobile">
	<svg class="icon -hidden-mobile" aria-hidden="true">
		<use xlink:href="#icon-menu1"></use>
	</svg>
	<div class="ss-tooltip">
		
		
		<div class="toc-list">
			<h4 class="title">Main Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-boot/overview/>
						SOFABoot
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-rpc/overview/>
						SOFARPC
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-tracer/overview/>
						SOFATracer
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-lookout/overview/>
						SOFALookout
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-registry/overview/>
						SOFARegistry
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Incubating Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-mesh/overview/>
						SOFAMesh
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-dashboard/overview/>
						SOFADashboard
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Tool Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-bolt/overview/>
						SOFABolt
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-jraft/overview/>
						SOFAJRaft
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-acts/overview/>
						SOFAActs
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://www.sofastack.tech/en/projects/sofa-boot/sofa-ark-readme//>
						SOFAArk
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Ecosystem Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://mosn.io/en/>
						MOSN
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://occlum.io/>
						Occlum
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://seata.io/>
						Seata
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://mosn.io/layotto/>
						Layotto
					</a>
				</li>
				
			</ul>
		</div>
		
		
	</div>
</div>

			</div>
			<div class="body">
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="SOFATracer overview"
						href="/sofastack.tech/en/projects/sofa-tracer/overview/"
					>SOFATracer overview</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Terminologies"
						href="/sofastack.tech/en/projects/sofa-tracer/explanation/"
					>Terminologies</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="TraceId and spanId generation rule"
						href="/sofastack.tech/en/projects/sofa-tracer/traceid-generated-rule/"
					>TraceId and spanId generation rule</a>
				</div>
			</li>
		
		
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Quick start guide"
					>Quick start guide</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="Spring MVC Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-mvc/"
					>Spring MVC Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="HttpClient Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-httpclient/"
					>HttpClient Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="DataSource Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-datasource/"
					>DataSource Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="RestTemplate Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-resttemplate/"
					>RestTemplate Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="OkHttp Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-okhttp/"
					>OkHttp Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Dubbo Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-dubbo/"
					>Dubbo Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="OpenFeign Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-openfeign/"
					>OpenFeign Integration</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Features"
					>Features</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link -current">
					<a
						title="Print traceId and spanId in application log"
						href="/sofastack.tech/en/projects/sofa-tracer/print-traceid-spanid/"
					>Print traceId and spanId in application log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Asynchronous thread processing"
						href="/sofastack.tech/en/projects/sofa-tracer/async/"
					>Asynchronous thread processing</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Functional interface support"
						href="/sofastack.tech/en/projects/sofa-tracer/functional-interface-support/"
					>Functional interface support</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Sampling modes"
						href="/sofastack.tech/en/projects/sofa-tracer/sampler/"
					>Sampling modes</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Report data to Zipkin"
						href="/sofastack.tech/en/projects/sofa-tracer/report-to-zipkin/"
					>Report data to Zipkin</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="SOFATracer Tools"
						href="/sofastack.tech/en/projects/sofa-tracer/utils/"
					>SOFATracer Tools</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="SOFATracer configuration items"
						href="/sofastack.tech/en/projects/sofa-tracer/configuration/"
					>SOFATracer configuration items</a>
				</div>
			</li>
		
		
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Log format"
					>Log format</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="Spring MVC log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-springmvc/"
					>Spring MVC log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="HttpClient log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-httpclient/"
					>HttpClient log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="DataSource log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-datasource/"
					>DataSource log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="SOFARPC log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-sofarpc/"
					>SOFARPC log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="OkHttp log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-okhttp/"
					>OkHttp log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="RestTemplate log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-resttemplate/"
					>RestTemplate log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Dubbo log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-dubbo/"
					>Dubbo log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="OpenFeign log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-openfeign/"
					>OpenFeign log</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
</ul>
			</div>
		</div>
	</div>

	</aside>

	<main class="ss-layout-main -card">
		




<div class="ss-meta">
	<div class="container">
		<h1 class="title">
			Print traceId and spanId in application log
		</h1>
		<a class="edit-button -hidden-mobile"
			href="https://github.com/sofastack/sofastack.tech/edit/master/content/en/projects/sofa-tracer/print-traceid-spanid/index.md"
		>Edit</a>
	</div>
	<div class="meta">
		Update time: 2024-06-18 
		
			
		
	</div>
</div>

		<article class="typo">
  <h1 id="print-traceid-and-spanid-to-application-log">Print traceId And spanId To Application Log</h1>

<p>SLF4J provides MDC (Mapped Diagnostic Contexts), which supports you to define and modify log output formats and content. This document introduces the  SLF4J MDC feature integrated in SOFATracer, which allows you to output the current SOFATracer context <code>TraceId</code> and <code>SpanId</code> with simply modifying the log configuration file.</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>In order to properly print the <code>TraceId</code> and <code>SpanId</code> parameters in the logs of the application, the log programming interface needs to be programmed for <a href="https://www.slf4j.org/manual.html"><code>SLF4J</code></a>. That is, the programming interface for printing log does not rely on specific log implementation.</p>

<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.slf4j&lt;/groupId&gt;
    &lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>

<h2 id="introduce-dependency">Introduce dependency</h2>

<p>For SOFABoot or Spring Boot application, you need to introduce the specific log implementation. It is recommended to introduce Logback and Log4j2 instead of Log4j. Also, it is suggested to use only one log implementation rather than multiple implementations.</p>

<ul>
<li>Logback implementation:</li>
</ul>

<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-logging&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>

<ul>
<li>Log4j2 implementation:</li>
</ul>

<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-log4j2&lt;/artifactId&gt;
    &lt;!--SOFABoot does not control log4j2 version --&gt;
    &lt;version&gt;1.4.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h2 id="configuration-method">Configuration method</h2>

<p>The corresponding TraceId and SpanId are printed based on <a href="https://www.slf4j.org/manual.html">SLF4J MDC</a>. First, the log programming interface in application should be oriented to <code>SLF4J</code>, as follows:</p>

<pre><code class="language-java">/ / Introduce interface
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
    
/ / Construct log printing instance
private static final Logger logger = LoggerFactory.getLogger(XXX.class);
</code></pre>

<p>Second, to correctly print the <code>TraceId</code> and <code>SpanId</code> parameters, we also need to configure the extra parameters of <code>PatternLayout</code> in the log configuration file. The two parameters are <code>%X{SOFA-TraceId}</code> and <code>%X. {SOFA-SpanId}</code>, whose values ​​can be obtained from MDC.</p>

<p><a href="https://logback.qos.ch/"> <code>pattern</code> parameter configured with <code>Logback</code> as an example</a>:</p>

<pre><code class="language-xml">&lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} %5p  [%X{SOFA-TraceId},
%X{SOFA-SpanId}] 
---- %m%n&lt;/pattern&gt;
</code></pre>

<ul>
<li>Key configuration items: As a part of the <code>Logback pattern</code>, <code>[%X{SOFA-TraceId},%X{SOFA-SpanId}]</code> replaces the placeholders in the pattern with the specific TraceId and SpanId in the current thread process when the corresponding <code>appender</code> is called. If there is no corresponding TraceId and SpanId in the current thread, the placeholder is replaced with &ldquo;null&rdquo;.</li>
</ul>

<p><a href="https://logging.apache.org/log4j/2.0/manual/layouts.html">Log4j2 PatternLayout configuration sample</a>:</p>

<pre><code class="language-xml">&lt;PatternLayout pattern=&quot;%d{yyyy-MM-dd HH:mm:ss.SSS} %5p 
[%X{SOFA-TraceId},%X{SOFA-SpanId}] ---- %m%n &quot; /&gt;
</code></pre>

<p><a href="https://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html">Log4j PatternLayout configuration sample</a>:</p>

<pre><code class="language-xml"> &lt;layout class=&quot;org.apache.log4j.PatternLayout&quot;&gt;
     &lt;param name=&quot;ConversionPattern&quot; value=&quot;%d %-5p %-32t 
     [%X{SOFA-TraceId},%X{SOFA-SpanId}] - %m%n&quot;/&gt;
 &lt;/layout&gt;
</code></pre>

<blockquote>
<p>Note: <code>[%X{SOFA-TraceId},%X{SOFA-SpanId}]</code> is the recommended printing format, which can be customized based on your actual scenario requirements.</p>
</blockquote>

</article>

<script>
  const article = document.querySelector('article.typo')
  
  const imgElements = article.querySelectorAll('img');
  
  imgElements.forEach(img => {
    const src = img.getAttribute('src');
    
    if (src.toLowerCase().endsWith('.image')) {
      img.setAttribute('src', src.replace('.image', ''));
    }
    img.setAttribute('referrerpolicy', 'no-referrer');
  });
</script>


	</main>
</div>



	


<footer class="ss-footer">
	<div class="container">
		<div class="links">
			
				<div class="cate">
					<h2 class="cate-title">Resources</h2>
					
						<a class="link" href="https://github.com/sofastack">Github</a>
					
						<a class="link" href="https://gitee.com/sofastack/">Gitee</a>
					
						<a class="link" href="https://github.com/sofastack-guides">Samples</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Social Media</h2>
					
						<a class="link" href="https://zhuanlan.zhihu.com/sofastack">Zhihu</a>
					
						<a class="link" href="https://weibo.com/sofastack">Weibo</a>
					
						<a class="link" href="https://twitter.com/sofastack_io">Twitter</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Get Involved</h2>
					
						<a class="link" href="https://github.com/sofastack/sofastack.tech/issues">Feedback</a>
					
						<a class="link" href="https://github.com/sofastack/community">Community</a>
					
						<a class="link" href="https://github.com/sofastack/sofastack.tech/wiki">Wiki</a>
					
						<a class="link" href="mailto:sofa@alipay.cloud.com">Email</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Ant Financial Open Source</h2>
					
						<a class="link" href="https://ant.design/">Ant Design</a>
					
						<a class="link" href="https://eggjs.org/">Egg</a>
					
						<a class="link" href="https://sqlflow.org">SQLFlow</a>
					
						<a class="link" href="https://tech.antfin.com/open-source">More</a>
					
				</div>
			
		</div>
		<div class="qrcode">
			
				<div>
					<img class="qrcode-img" src="/sofastack.tech/img/qrcode/qrcode_1.png" />
					<p class="qrcode-desc">Wechat Official Account</p>
				</div>
			
				<div>
					<img class="qrcode-img" src="/sofastack.tech/img/qrcode/qrcode_2.png" />
					<p class="qrcode-desc">DingTalk Group</p>
				</div>
			
		</div>
	</div>
	<div class="copyright">
		<p>
			© 2018 - 2022  The SOFAStack Authors
			<a href="http://beian.miit.gov.cn/">浙 ICP 备 16045294 号-3</a>
		</p>
	</div>
</footer>

</body>

</html>