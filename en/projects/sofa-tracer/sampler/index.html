<!DOCTYPE html>
<html>

<head>
	<title>
	Sampling modes · SOFAStack
</title>
	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="SOFAStack is a Scalable Open Financial Architecture for building cloud native applications" />

<meta name="generator" content="Hugo 0.55.5" /><link rel="shortcut icon" href=https://gw.alipayobjects.com/os/q/cms/images/jqu9346l/4ba95631-2489-4885-881f-bc7f8d787d5e_w64_h61.png type="image/png">

<link href="https://unpkg.com/purecss@1.0.0/build/base-min.css" rel="stylesheet">



<link href="/sofastack.tech/css/main.css" rel="stylesheet">
<link href="/sofastack.tech/css/zoom-image.css" rel="stylesheet">

<script src="/sofastack.tech/js/iconfont.js"></script>
<script src="/sofastack.tech/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>window.SITE_LANGUAGE = "en"</script>
<script src="/sofastack.tech/js/app.js"></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-142131411-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body>
	<header class="ss-header">
	<nav class="navbar" role="navigation" aria-label="main navigation">
		<div class="navbar-brand">
			<a class="logo-link" href="/sofastack.tech/en/">
				<img class="logo" src="/sofastack.tech/img/logo.png">
			</a>
			<div class="-show-mobile">
				<a id="mobile-menu-icon">
					<svg class="icon" aria-hidden="true">
						<use xlink:href="#icon-menu"></use>
					</svg>
				</a>
				<nav id="mobile-menu">
						<div id="js-menu-search-mobile" class="navbar-search-mobile">
							<input class="input" placeholder="Search">
							<svg class="icon" aria-hidden="true">
								<use xlink:href="#icon-search"></use>
							</svg>
						</div>
					
          
            <a
              class=""
              href="/sofastack.tech/en/projects/">
              <span>
                Projects
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/guides/">
              <span>
                Guides
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/blog/">
              <span>
                Blog
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/activities/">
              <span>
                Activity
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/awesome/">
              <span>
                Awesome SOFA
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
					
            
              <a href="/sofastack.tech/projects/sofa-tracer/sampler/">
                <span>中文</span>
                <svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"></use></svg>
              </a>
						
					
				</nav>
			</div>
		</div>

		<div class="navbar-menu -hidden-mobile">
			<div class="navbar-start">
				
				
					<a class="navbar-item "
						href="/sofastack.tech/en/projects/">Projects</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/guides/">Guides</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/blog/">Blog</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/activities/">Activity</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/awesome/">Awesome SOFA</a>
				
			</div>
			<div class="navbar-end">
				<div class="navbar-item">
					<div id="js-menu-search" class="navbar-search">
						<input class="input" placeholder="Search">
						<svg class="icon" aria-hidden="true">
							<use xlink:href="#icon-search"></use>
						</svg>
					</div>
				</div>
				<div class="navbar-item">
					
						
							<a class="translation" href="/sofastack.tech/projects/sofa-tracer/sampler/">中</a>
						
					
				</div>
			</div>
		</div>
	</nav>
</header>


	

	

	

	

	



	

<div class="ss-layout-container">
	<aside class="ss-layout-aside -left ss-card -soft-hidden">
		






	<div id="js-drawer" class="ss-toc">
		<div id="js-drawer-handle" class="drawer-handle">
			<svg class="icon icon-menu" aria-hidden="true">
				<use xlink:href="#icon-menu"></use>
			</svg>
			<svg class="icon icon-close" aria-hidden="true">
				<use xlink:href="#icon-close"></use>
			</svg>
		</div>
		<div class="drawer-body">
			<div class="header" title="SOFATracer is a distributed link tracing system based on OpenTracing specification.">SOFATracer

































































































































































































































































































































































































































































































<div class="ss-toc-list-card -hidden-mobile">
	<svg class="icon -hidden-mobile" aria-hidden="true">
		<use xlink:href="#icon-menu1"></use>
	</svg>
	<div class="ss-tooltip">
		
		
		<div class="toc-list">
			<h4 class="title">Main Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-boot/overview/>
						SOFABoot
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-rpc/overview/>
						SOFARPC
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-tracer/overview/>
						SOFATracer
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-lookout/overview/>
						SOFALookout
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-registry/overview/>
						SOFARegistry
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Incubating Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-mesh/overview/>
						SOFAMesh
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-dashboard/overview/>
						SOFADashboard
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Tool Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-bolt/overview/>
						SOFABolt
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-jraft/overview/>
						SOFAJRaft
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-acts/overview/>
						SOFAActs
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://www.sofastack.tech/en/projects/sofa-boot/sofa-ark-readme//>
						SOFAArk
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Ecosystem Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://mosn.io/en/>
						MOSN
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://occlum.io/>
						Occlum
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://seata.io/>
						Seata
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://mosn.io/layotto/>
						Layotto
					</a>
				</li>
				
			</ul>
		</div>
		
		
	</div>
</div>

			</div>
			<div class="body">
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="SOFATracer overview"
						href="/sofastack.tech/en/projects/sofa-tracer/overview/"
					>SOFATracer overview</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Terminologies"
						href="/sofastack.tech/en/projects/sofa-tracer/explanation/"
					>Terminologies</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="TraceId and spanId generation rule"
						href="/sofastack.tech/en/projects/sofa-tracer/traceid-generated-rule/"
					>TraceId and spanId generation rule</a>
				</div>
			</li>
		
		
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Quick start guide"
					>Quick start guide</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="Spring MVC Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-mvc/"
					>Spring MVC Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="HttpClient Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-httpclient/"
					>HttpClient Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="DataSource Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-datasource/"
					>DataSource Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="RestTemplate Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-resttemplate/"
					>RestTemplate Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="OkHttp Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-okhttp/"
					>OkHttp Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Dubbo Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-dubbo/"
					>Dubbo Integration</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="OpenFeign Integration"
						href="/sofastack.tech/en/projects/sofa-tracer/usage-of-openfeign/"
					>OpenFeign Integration</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Features"
					>Features</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="Print traceId and spanId in application log"
						href="/sofastack.tech/en/projects/sofa-tracer/print-traceid-spanid/"
					>Print traceId and spanId in application log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Asynchronous thread processing"
						href="/sofastack.tech/en/projects/sofa-tracer/async/"
					>Asynchronous thread processing</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Functional interface support"
						href="/sofastack.tech/en/projects/sofa-tracer/functional-interface-support/"
					>Functional interface support</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link -current">
					<a
						title="Sampling modes"
						href="/sofastack.tech/en/projects/sofa-tracer/sampler/"
					>Sampling modes</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Report data to Zipkin"
						href="/sofastack.tech/en/projects/sofa-tracer/report-to-zipkin/"
					>Report data to Zipkin</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="SOFATracer Tools"
						href="/sofastack.tech/en/projects/sofa-tracer/utils/"
					>SOFATracer Tools</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="SOFATracer configuration items"
						href="/sofastack.tech/en/projects/sofa-tracer/configuration/"
					>SOFATracer configuration items</a>
				</div>
			</li>
		
		
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Log format"
					>Log format</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="Spring MVC log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-springmvc/"
					>Spring MVC log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="HttpClient log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-httpclient/"
					>HttpClient log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="DataSource log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-datasource/"
					>DataSource log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="SOFARPC log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-sofarpc/"
					>SOFARPC log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="OkHttp log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-okhttp/"
					>OkHttp log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="RestTemplate log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-resttemplate/"
					>RestTemplate log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Dubbo log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-dubbo/"
					>Dubbo log</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="OpenFeign log"
						href="/sofastack.tech/en/projects/sofa-tracer/log-format-openfeign/"
					>OpenFeign log</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
</ul>
			</div>
		</div>
	</div>

	</aside>

	<main class="ss-layout-main -card">
		




<div class="ss-meta">
	<div class="container">
		<h1 class="title">
			Sampling modes
		</h1>
		<a class="edit-button -hidden-mobile"
			href="https://github.com/sofastack/sofastack.tech/edit/master/content/en/projects/sofa-tracer/sampler/index.md"
		>Edit</a>
	</div>
	<div class="meta">
		Update time: 2024-06-18 
		
			
		
	</div>
</div>

		<article class="typo">
  <h1 id="sampling">Sampling</h1>

<p>Currently,SOFATracer provides two sampling modes. One is the fixed sampling rate based on BitSet. The other is the sampling provided to the user to customize the implementation sampling.The following example shows how to use it.</p>

<p>This example is based on the tracer-sampled-with-springmvc project,Except for <code>application.properties</code>, everything else is the same.</p>

<h2 id="sampling-mode-based-on-fixed-sampling-rate">Sampling mode based on fixed sampling rate</h2>

<h3 id="add-sampling-related-configuration-items-in-application-properties">Add sampling related configuration items in application.properties</h3>

<pre><code class="language-properties">#Sampling rate  0~100
com.alipay.sofa.tracer.samplerPercentage=100
#Sampling type name
com.alipay.sofa.tracer.samplerName=PercentageBasedSampler
</code></pre>

<h3 id="verification">Verification</h3>

<ul>
<li>When the sample rate is set to 100, the digest log is printed each time.</li>
<li>When the sample rate is set to 0, the digest log is not printed.</li>
<li>Print by probability when the sampling rate is set between 0 and 100.</li>
</ul>

<p>The result is verified by requesting 10 times.</p>

<p>1、When the sample rate is set to 100, the digest log is printed each time.</p>

<p>Start the project and enter in the browser:<a href="http://localhost:8080/springmvc">http://localhost:8080/springmvc</a> ,And refresh the address 10 times, check the log as follows:</p>

<pre><code class="language-json">{&quot;time&quot;:&quot;2018-11-09 11:54:47.643&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173568757510019269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:68,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-1&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:50.980&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569097710029269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:3,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-2&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:51.542&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569153910049269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:3,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-4&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:52.061&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569205910069269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-6&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:52.560&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569255810089269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-8&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:52.977&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569297610109269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:1,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-10&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:53.389&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569338710129269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-2&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:53.742&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569374110149269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:1,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-4&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:54.142&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569414010169269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-6&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 11:54:54.565&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173569456310189269&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-8&quot;,&quot;baggage&quot;:&quot;&quot;}
</code></pre>

<p>2、When the sample rate is set to 0, the digest log is not printed.</p>

<p>Start the project and enter in the browser:<a href="http://localhost:8080/springmvc">http://localhost:8080/springmvc</a> ,And refresh the address 10 times,
View the ./logs/tracerlog/ directory without the spring-mvc-digest.log log file</p>

<p>3、Print by probability when the sampling rate is set between 0 and 100.</p>

<p>Set the sampling rate to 20</p>

<ul>
<li>Request 10 times</li>
</ul>

<pre><code class="language-json">{&quot;time&quot;:&quot;2018-11-09 12:14:29.466&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173686946410159846&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-5&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 12:15:21.776&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173692177410319846&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-2&quot;,&quot;baggage&quot;:&quot;&quot;}
</code></pre>

<ul>
<li>Request 20 times</li>
</ul>

<pre><code class="language-json">{&quot;time&quot;:&quot;2018-11-09 12:14:29.466&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173686946410159846&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-5&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 12:15:21.776&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173692177410319846&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-2&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 12:15:22.439&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173692243810359846&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:1,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-6&quot;,&quot;baggage&quot;:&quot;&quot;}
{&quot;time&quot;:&quot;2018-11-09 12:15:22.817&quot;,&quot;local.app&quot;:&quot;SOFATracerSpringMVC&quot;,&quot;traceId&quot;:&quot;0a0fe8ec154173692281510379846&quot;,&quot;spanId&quot;:&quot;0.1&quot;,&quot;request.url&quot;:&quot;http://localhost:8080/springmvc&quot;,&quot;method&quot;:&quot;GET&quot;,&quot;result.code&quot;:&quot;200&quot;,&quot;req.size.bytes&quot;:-1,&quot;resp.size.bytes&quot;:0,&quot;time.cost.milliseconds&quot;:2,&quot;current.thread.name&quot;:&quot;http-nio-8080-exec-8&quot;,&quot;baggage&quot;:&quot;&quot;}
</code></pre>

<blockquote>
<p>The test results are for reference only</p>
</blockquote>

<h2 id="custom-sampling-mode">Custom sampling mode</h2>

<p>An sampler interface for sample rate calculation is provided in SOFATracer. If you need to customize your own sampling strategy, you can extend it by implementing this interface. Let&rsquo;s use a simple demo to demonstrate how to use the custom sampling mode.</p>

<h3 id="custom-sampling-rule-class">Custom sampling rule class</h3>

<pre><code class="language-java">public class CustomOpenRulesSamplerRuler implements Sampler {

    private static final String TYPE = &quot;CustomOpenRulesSamplerRuler&quot;;

    @Override
    public SamplingStatus sample(SofaTracerSpan sofaTracerSpan) {
        SamplingStatus samplingStatus = new SamplingStatus();
        Map&lt;String, Object&gt; tags = new HashMap&lt;String, Object&gt;();
        tags.put(SofaTracerConstant.SAMPLER_TYPE_TAG_KEY, TYPE);
        tags = Collections.unmodifiableMap(tags);
        samplingStatus.setTags(tags);

        if (sofaTracerSpan.isServer()) {
            samplingStatus.setSampled(false);
        } else {
            samplingStatus.setSampled(true);
        }
        return samplingStatus;
    }

    @Override
    public String getType() {
        return TYPE;
    }

    @Override
    public void close() {
        // do nothing 
    }
}
</code></pre>

<p>In the sample method, the user can decide whether to print based on the information provided by the current sofaTracerSpan. This case determines whether to sample by isServer, isServer=true, does not sample, otherwise samples.</p>

<h3 id="add-sampling-related-configuration-items-in-application-properties-1">Add sampling related configuration items in application.properties</h3>

<pre><code class="language-properties">com.alipay.sofa.tracer.samplerName.samplerCustomRuleClassName=com.alipay.sofa.tracer.examples.springmvc.sampler.CustomOpenRulesSamplerRuler
</code></pre>

<p>The relevant test results can be verified by yourself.</p>

</article>

<script>
  const article = document.querySelector('article.typo')
  
  const imgElements = article.querySelectorAll('img');
  
  imgElements.forEach(img => {
    const src = img.getAttribute('src');
    
    if (src.toLowerCase().endsWith('.image')) {
      img.setAttribute('src', src.replace('.image', ''));
    }
    img.setAttribute('referrerpolicy', 'no-referrer');
  });
</script>


	</main>
</div>



	


<footer class="ss-footer">
	<div class="container">
		<div class="links">
			
				<div class="cate">
					<h2 class="cate-title">Resources</h2>
					
						<a class="link" href="https://github.com/sofastack">Github</a>
					
						<a class="link" href="https://gitee.com/sofastack/">Gitee</a>
					
						<a class="link" href="https://github.com/sofastack-guides">Samples</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Social Media</h2>
					
						<a class="link" href="https://zhuanlan.zhihu.com/sofastack">Zhihu</a>
					
						<a class="link" href="https://weibo.com/sofastack">Weibo</a>
					
						<a class="link" href="https://twitter.com/sofastack_io">Twitter</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Get Involved</h2>
					
						<a class="link" href="https://github.com/sofastack/sofastack.tech/issues">Feedback</a>
					
						<a class="link" href="https://github.com/sofastack/community">Community</a>
					
						<a class="link" href="https://github.com/sofastack/sofastack.tech/wiki">Wiki</a>
					
						<a class="link" href="mailto:sofa@alipay.cloud.com">Email</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Ant Financial Open Source</h2>
					
						<a class="link" href="https://ant.design/">Ant Design</a>
					
						<a class="link" href="https://eggjs.org/">Egg</a>
					
						<a class="link" href="https://sqlflow.org">SQLFlow</a>
					
						<a class="link" href="https://tech.antfin.com/open-source">More</a>
					
				</div>
			
		</div>
		<div class="qrcode">
			
				<div>
					<img class="qrcode-img" src="/sofastack.tech/img/qrcode/qrcode_1.png" />
					<p class="qrcode-desc">Wechat Official Account</p>
				</div>
			
				<div>
					<img class="qrcode-img" src="/sofastack.tech/img/qrcode/qrcode_2.png" />
					<p class="qrcode-desc">DingTalk Group</p>
				</div>
			
		</div>
	</div>
	<div class="copyright">
		<p>
			© 2018 - 2022  The SOFAStack Authors
			<a href="http://beian.miit.gov.cn/">浙 ICP 备 16045294 号-3</a>
		</p>
	</div>
</footer>

</body>

</html>