<!DOCTYPE html>
<html>

<head>
	<title>
	Client usage · SOFAStack
</title>
	<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,minimum-scale=1">
<meta name="description" content="SOFAStack is a Scalable Open Financial Architecture for building cloud native applications" />

<meta name="generator" content="Hugo 0.55.5" /><link rel="shortcut icon" href=https://gw.alipayobjects.com/os/q/cms/images/jqu9346l/4ba95631-2489-4885-881f-bc7f8d787d5e_w64_h61.png type="image/png">

<link href="https://unpkg.com/purecss@1.0.0/build/base-min.css" rel="stylesheet">



<link href="/sofastack.tech/css/main.css" rel="stylesheet">
<link href="/sofastack.tech/css/zoom-image.css" rel="stylesheet">

<script src="/sofastack.tech/js/iconfont.js"></script>
<script src="/sofastack.tech/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script>window.SITE_LANGUAGE = "en"</script>
<script src="/sofastack.tech/js/app.js"></script>





<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-142131411-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body>
	<header class="ss-header">
	<nav class="navbar" role="navigation" aria-label="main navigation">
		<div class="navbar-brand">
			<a class="logo-link" href="/sofastack.tech/en/">
				<img class="logo" src="/sofastack.tech/img/logo.png">
			</a>
			<div class="-show-mobile">
				<a id="mobile-menu-icon">
					<svg class="icon" aria-hidden="true">
						<use xlink:href="#icon-menu"></use>
					</svg>
				</a>
				<nav id="mobile-menu">
						<div id="js-menu-search-mobile" class="navbar-search-mobile">
							<input class="input" placeholder="Search">
							<svg class="icon" aria-hidden="true">
								<use xlink:href="#icon-search"></use>
							</svg>
						</div>
					
          
            <a
              class=""
              href="/sofastack.tech/en/projects/">
              <span>
                Projects
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/guides/">
              <span>
                Guides
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/blog/">
              <span>
                Blog
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/en/activities/">
              <span>
                Activity
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
            <a
              class=""
              href="/sofastack.tech/awesome/">
              <span>
                Awesome SOFA
              </span>
              <svg class="icon" aria-hidden="true"><use xlink:href="#icon-ARROW"></use></svg>
            </a>
					
					
            
              <a href="/sofastack.tech/projects/sofa-registry/client-quick-start/">
                <span>中文</span>
                <svg class="icon" aria-hidden="true"><use xlink:href="#icon-transfer"></use></svg>
              </a>
						
					
				</nav>
			</div>
		</div>

		<div class="navbar-menu -hidden-mobile">
			<div class="navbar-start">
				
				
					<a class="navbar-item "
						href="/sofastack.tech/en/projects/">Projects</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/guides/">Guides</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/blog/">Blog</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/en/activities/">Activity</a>
				
					<a class="navbar-item "
						href="/sofastack.tech/awesome/">Awesome SOFA</a>
				
			</div>
			<div class="navbar-end">
				<div class="navbar-item">
					<div id="js-menu-search" class="navbar-search">
						<input class="input" placeholder="Search">
						<svg class="icon" aria-hidden="true">
							<use xlink:href="#icon-search"></use>
						</svg>
					</div>
				</div>
				<div class="navbar-item">
					
						
							<a class="translation" href="/sofastack.tech/projects/sofa-registry/client-quick-start/">中</a>
						
					
				</div>
			</div>
		</div>
	</nav>
</header>


	

	

	

	

	



	

<div class="ss-layout-container">
	<aside class="ss-layout-aside -left ss-card -soft-hidden">
		






	<div id="js-drawer" class="ss-toc">
		<div id="js-drawer-handle" class="drawer-handle">
			<svg class="icon icon-menu" aria-hidden="true">
				<use xlink:href="#icon-menu"></use>
			</svg>
			<svg class="icon icon-close" aria-hidden="true">
				<use xlink:href="#icon-close"></use>
			</svg>
		</div>
		<div class="drawer-body">
			<div class="header" title="SOFARegistry is a production-level, low-latency, and highly available service registry powered by Ant Financial.">SOFARegistry

































































































































































































































































































































































































































































































<div class="ss-toc-list-card -hidden-mobile">
	<svg class="icon -hidden-mobile" aria-hidden="true">
		<use xlink:href="#icon-menu1"></use>
	</svg>
	<div class="ss-tooltip">
		
		
		<div class="toc-list">
			<h4 class="title">Main Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-boot/overview/>
						SOFABoot
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-rpc/overview/>
						SOFARPC
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-tracer/overview/>
						SOFATracer
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-lookout/overview/>
						SOFALookout
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-registry/overview/>
						SOFARegistry
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Incubating Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-mesh/overview/>
						SOFAMesh
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-dashboard/overview/>
						SOFADashboard
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Tool Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-bolt/overview/>
						SOFABolt
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-jraft/overview/>
						SOFAJRaft
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					<a href=/sofastack.tech/en/projects/sofa-acts/overview/>
						SOFAActs
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://www.sofastack.tech/en/projects/sofa-boot/sofa-ark-readme//>
						SOFAArk
					</a>
				</li>
				
			</ul>
		</div>
		
		
		
		<div class="toc-list">
			<h4 class="title">Ecosystem Projects</h4>
			<ul class="list">
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://mosn.io/en/>
						MOSN
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://occlum.io/>
						Occlum
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://seata.io/>
						Seata
					</a>
				</li>
				
				<li class="item">
					
					
					
					
					
					
					<a href=https://mosn.io/layotto/>
						Layotto
					</a>
				</li>
				
			</ul>
		</div>
		
		
	</div>
</div>

			</div>
			<div class="body">
				



<ul class="leaf-section">
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Introduction"
					>Introduction</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="Overview"
						href="/sofastack.tech/en/projects/sofa-registry/overview/"
					>Overview</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link">
					<a
						title="Terminology"
						href="/sofastack.tech/en/projects/sofa-registry/terminology/"
					>Terminology</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Quick start"
					>Quick start</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="Server deployment"
						href="/sofastack.tech/en/projects/sofa-registry/server-quick-start/"
					>Server deployment</a>
				</div>
			</li>
		
		
	
		
			<li class="item">
				<div class="link -current">
					<a
						title="Client usage"
						href="/sofastack.tech/en/projects/sofa-registry/client-quick-start/"
					>Client usage</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
		
		
			<li class="item">
				<div class="link">
					<svg class="icon arrow" aria-hidden="true">
						<use xlink:href="#icon-arrow"></use>
					</svg>
					<a
						title="Developer guide"
					>Developer guide</a>
				</div>
				



<ul class="leaf-section">
	
		
			<li class="item">
				<div class="link">
					<a
						title="JAVA SDK"
						href="/sofastack.tech/en/projects/sofa-registry/java-sdk/"
					>JAVA SDK</a>
				</div>
			</li>
		
		
	
</ul>
			</li>
		
	
</ul>
			</div>
		</div>
	</div>

	</aside>

	<main class="ss-layout-main -card">
		




<div class="ss-meta">
	<div class="container">
		<h1 class="title">
			Client usage
		</h1>
		<a class="edit-button -hidden-mobile"
			href="https://github.com/sofastack/sofastack.tech/edit/master/content/en/projects/sofa-registry/client-quick-start/index.md"
		>Edit</a>
	</div>
	<div class="meta">
		Update time: 2024-06-18 
		
			
		
	</div>
</div>

		<article class="typo">
  <h2 id="1-create-a-maven-project">1. Create a Maven project</h2>

<p>After deploying the servers, we can create a new Maven project to use services provided by SOFARegistry. Create a new Maven project, and then import the following dependency:</p>

<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;com.alipay.sofa&lt;/groupId&gt;
    &lt;artifactId&gt;registry-client-all&lt;/artifactId&gt;
    &lt;version&gt;${registry.client.version}&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h2 id="2-publish-data">2. Publish data</h2>

<pre><code class="language-java">// Create a client instance.
RegistryClientConfig config = DefaultRegistryClientConfigBuilder.start().setRegistryEndpoint(&quot;127.0.0.1&quot;).setRegistryEndpointPort(9603).build();
DefaultRegistryClient registryClient = new DefaultRegistryClient(config);
registryClient.init();

// Create a publisher registry.
String dataId = &quot;com.alipay.test.demo.service:1.0@DEFAULT&quot;;
PublisherRegistration registration = new PublisherRegistration(dataId);

// Register the registry with the client and publish data.
registryClient.register(registration, &quot;10.10.1.1:12200?xx=yy&quot;);
</code></pre>

<p>Perform the following steps to publish data by using SOFARegistry:</p>

<ol>
<li>Create a client instance.</li>
<li>Create a publisher registry.</li>
<li>Register the registry with the client and publish data.</li>
</ol>

<h3 id="2-1-create-a-client-instance">2.1 Create a client instance</h3>

<p>The key to creating a client instance is to create a RegistryClientConfig object. When creating a RegistryClientConfig object, you need to specify the RegistryEndpoint and RegistryEndpointPort.</p>

<ul>
<li>RegistryEndpoint: the endpoint of any session node of SOFARegistry</li>
<li>RegistryEndpointPort: the session.server.httpServerPort port number configured for a session node</li>
</ul>

<h3 id="2-2-create-a-publisher-registry">2.2 Create a publisher registry</h3>

<p>To create a publisher registry, you only need to create a PublisherRegistration object and specify the dataId, which is the unique identifier of the publisher service.</p>

<h3 id="2-3-publish-data">2.3 Publish data</h3>

<p>You can call the register method of the RegistryClient to publish data. This method requires two parameters: the first is a publisher registry with the specified dataId of a service, and the second is a string type data value.</p>

<h2 id="3-subscribe-to-the-data">3. Subscribe to the data</h2>

<pre><code class="language-java">// Create a client instance.
RegistryClientConfig config = DefaultRegistryClientConfigBuilder.start().setRegistryEndpoint(&quot;127.0.0.1&quot;).setRegistryEndpointPort(9603).build();
DefaultRegistryClient registryClient = new DefaultRegistryClient(config);
registryClient.init();

// Create SubscriberDataObserver. 
SubscriberDataObserver subscriberDataObserver = new SubscriberDataObserver() {
    public void handleData(String dataId, UserData userData) {
            System.out.println(&quot;receive data success, dataId: &quot; + dataId + &quot;, data: &quot; + userData);
    }
};

// Create a subscriber registry and specify the subscription level. ScopeEnum covers three subscription levels: zone, dataCenter, and global.
String dataId = &quot;com.alipay.test.demo.service:1.0@DEFAULT&quot;;
SubscriberRegistration registration = new SubscriberRegistration(dataId, subscriberDataObserver);
registration.setScopeEnum(ScopeEnum.global);

// Register the registry with the client and subscribe to the data. The subscribed data will be sent to SubscriberDataObserver in the form of a callback.
registryClient.register(registration);
</code></pre>

<p>Perform the following steps to subscribe to data by using SOFARegistry:</p>

<ol>
<li>Create a client instance.</li>
<li>Create SubscriberDataObserver.</li>
<li>Create a subscriber registry.</li>
<li>Register the registry with the client and subscribe to data.</li>
</ol>

<p>The client instance creation step is identical to that of the data publication step as described previously.</p>

<h3 id="3-1-create-subscriberdataobserver">3.1 Create SubscriberDataObserver</h3>

<p>SubscriberDataObserver is a callback interface that defines the handleData method, which provides two parameters: the dataId and the final data. This method will be called when the client receives the subscribed data. In SOFARegistry, data is returned from the servers in the form of UserData. This UserData class provides the following two methods:</p>

<pre><code class="language-java">public interface UserData {
    Map&lt;String, List&lt;String&gt;&gt; getZoneData();
    String getLocalZone();
}
</code></pre>

<ul>
<li>getLocalZone: returns the current zone.</li>
<li>getZoneData: returns data by taking zone as the key, and data of each zone as the value.</li>
</ul>

<h3 id="3-2-create-a-subscriber-registry">3.2 Create a subscriber registry</h3>

<p>To create a subscriber registry, you need to create a SubscriberRegistration object by specifying the dataId and the SubscriberDataObserver.</p>

<h3 id="3-3-subscribe-to-data">3.3 Subscribe to data</h3>

<p>You can call the register method of RegistryClient for data subscription. The register method requires only one parameter, that is the SubscriberRegistration object.</p>

<p>If we run first the data publication program and then the data subscription program, we can see the following output on the console:</p>

<pre><code class="language-plain">receive data success, dataId: com.alipay.test.demo.service:1.0@DEFAULT, data: DefaultUserData{zoneData={DEFAULT_ZONE=[10.10.1.1:12200?xx=yy]}, localZone='DEFAULT_ZONE'}
</code></pre>

</article>

<script>
  const article = document.querySelector('article.typo')
  
  const imgElements = article.querySelectorAll('img');
  
  imgElements.forEach(img => {
    const src = img.getAttribute('src');
    
    if (src.toLowerCase().endsWith('.image')) {
      img.setAttribute('src', src.replace('.image', ''));
    }
    img.setAttribute('referrerpolicy', 'no-referrer');
  });
</script>


	</main>
</div>



	


<footer class="ss-footer">
	<div class="container">
		<div class="links">
			
				<div class="cate">
					<h2 class="cate-title">Resources</h2>
					
						<a class="link" href="https://github.com/sofastack">Github</a>
					
						<a class="link" href="https://gitee.com/sofastack/">Gitee</a>
					
						<a class="link" href="https://github.com/sofastack-guides">Samples</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Social Media</h2>
					
						<a class="link" href="https://zhuanlan.zhihu.com/sofastack">Zhihu</a>
					
						<a class="link" href="https://weibo.com/sofastack">Weibo</a>
					
						<a class="link" href="https://twitter.com/sofastack_io">Twitter</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Get Involved</h2>
					
						<a class="link" href="https://github.com/sofastack/sofastack.tech/issues">Feedback</a>
					
						<a class="link" href="https://github.com/sofastack/community">Community</a>
					
						<a class="link" href="https://github.com/sofastack/sofastack.tech/wiki">Wiki</a>
					
						<a class="link" href="mailto:sofa@alipay.cloud.com">Email</a>
					
				</div>
			
				<div class="cate">
					<h2 class="cate-title">Ant Financial Open Source</h2>
					
						<a class="link" href="https://ant.design/">Ant Design</a>
					
						<a class="link" href="https://eggjs.org/">Egg</a>
					
						<a class="link" href="https://sqlflow.org">SQLFlow</a>
					
						<a class="link" href="https://tech.antfin.com/open-source">More</a>
					
				</div>
			
		</div>
		<div class="qrcode">
			
				<div>
					<img class="qrcode-img" src="/sofastack.tech/img/qrcode/qrcode_1.png" />
					<p class="qrcode-desc">Wechat Official Account</p>
				</div>
			
				<div>
					<img class="qrcode-img" src="/sofastack.tech/img/qrcode/qrcode_2.png" />
					<p class="qrcode-desc">DingTalk Group</p>
				</div>
			
		</div>
	</div>
	<div class="copyright">
		<p>
			© 2018 - 2022  The SOFAStack Authors
			<a href="http://beian.miit.gov.cn/">浙 ICP 备 16045294 号-3</a>
		</p>
	</div>
</footer>

</body>

</html>